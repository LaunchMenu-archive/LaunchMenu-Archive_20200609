{"version":3,"sources":["../../../src/core/registry/requestPath.js"],"names":["RequestPath","constructor","path","split","map","module","ID","modules","toString","unique","join","getSubPath","removeCount","requestPath","splice","length","augmentPath","resolve","reject","console","log","push","undefined","IPC","send","then","IDs","Math","max","apply","getModuleID","e","index","_isEndPoint","_getModuleInstance","_attachModuleInstance","moduleInstance","__addEndPoint","_detachModuleInstance","__removeEndPoint","moduleID","stringPath","endPoints","highestID","endPOints","__setup","on","event","data"],"mappings":"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","file":"requestPath.js","sourcesContent":["import IPC from \"../communication/IPC\";\r\nclass RequestPath{\r\n    constructor(path){\r\n        if(typeof(path)==\"string\"){\r\n            path = path\r\n                    .split(\"->\")\r\n                    .map(module=>{\r\n                        module = module.split(\":\");\r\n                        return {\r\n                            module: module[0],\r\n                            ID: module[1]||0\r\n                        };\r\n                    });\r\n        }\r\n\r\n        this.modules = path;\r\n    }\r\n    toString(unique){\r\n        return this.modules\r\n            .map(module=>{\r\n                if(unique)\r\n                    return module.module+\":\"+module.ID;\r\n                return module.module+\"\";\r\n            })\r\n            .join(\"->\");\r\n    }\r\n    getSubPath(removeCount){\r\n        const requestPath = new RequestPath(this.toString(true));\r\n        const modules = requestPath.modules;\r\n        modules.splice(modules.length-removeCount, removeCount);\r\n        return requestPath;\r\n    }\r\n    augmentPath(module, ID){\r\n        return new Promise((resolve, reject)=>{\r\n            try{\r\n                module = module.toString(); // Get the path in case it is a module instance\r\n                const requestPath = new RequestPath(this.toString(true));\r\n                console.log(requestPath);\r\n                requestPath.modules.push({\r\n                    module: module,\r\n                    ID: ID\r\n                });\r\n                if(ID!=undefined){\r\n                    resolve(requestPath);\r\n                }else{\r\n                    IPC.send(\"RequestPath.getID\", requestPath.toString()).then(IDs=>{\r\n                        ID = Math.max.apply(Math, IDs);\r\n                        requestPath.getModuleID().ID = ID;\r\n                        resolve(requestPath);\r\n                    })\r\n                }\r\n            }catch(e){\r\n                reject(e);\r\n            }\r\n        });\r\n    }\r\n    getModuleID(index){\r\n        if(index==undefined)\r\n            index = this.modules.length-1;\r\n        return this.modules[index];\r\n    }\r\n\r\n    // Protected methods\r\n    _isEndPoint(){\r\n        return this._getModuleInstance()!=null;\r\n    }\r\n    _getModuleInstance(){\r\n        return this.module;\r\n    }\r\n    _attachModuleInstance(moduleInstance){\r\n        this.module = moduleInstance;\r\n        RequestPath.__addEndPoint(this);\r\n    }\r\n    _detachModuleInstance(moduleInstance){\r\n        delete this.module;\r\n        RequestPath.__removeEndPoint(this);\r\n    }\r\n\r\n    // Private methods\r\n    static __addEndPoint(requestPath){\r\n        const moduleID = requestPath.getModuleID();\r\n        const stringPath = requestPath.toString();\r\n        if(!this.endPoints[stringPath])\r\n            this.endPoints[stringPath] = {\r\n                highestID: 0\r\n            };\r\n        console.log(stringPath, this.endPoints);\r\n        const endPoints = this.endPoints[stringPath];\r\n        endPoints[moduleID.ID] = RequestPath;\r\n        if(moduleID.ID>endPoints.highestID)\r\n            endPoints.highestID = moduleID.ID;\r\n    }\r\n    static __removeEndPoint(requestPath){\r\n        const moduleID = requestPath.getModuleID();\r\n        const stringPath = requestPath.toString();\r\n        const endPoints = this.endPoints[stringPath];\r\n        if(endPoints){\r\n            delete endPoints[moduleID.ID];\r\n            if(Object.keys(endPOints).length==1)\r\n                delete this.endPoints[stringPath];\r\n        }\r\n    }\r\n    static __setup(){\r\n        this.endPoints = {};    //The paths that have a module instance attached\r\n\r\n        IPC.on(\"RequestPath.getID\", event=>{\r\n            console.log(event, this.endPoints);\r\n            const requestPath = new RequestPath(event.data);\r\n            const stringPath = requestPath.toString();\r\n            const endPoints = this.endPoints[stringPath];\r\n            if(endPoints)\r\n                return endPoints.ID;\r\n            return 0;\r\n        });\r\n    }\r\n}\r\nRequestPath.__setup();\r\nexport default RequestPath;\r\n"]}